---
category: 数据库
---

## Mysql与B+树(1)

### 什么是Mysql、B+树？

Mysql是一种关系型数据库管理系统(DBMS)，其开源、免费、高效，使用非常广泛。关系型数据库就是基于关系模型而建立的数据库，数据库是一系列数据的集合，其中的数据又按照一定的规则存放在不同的表里面，这个规则是什么呢？用自己的话描述就是具有相同属性，且属性满足相同约束。术语为 `R（U，D，dom，F）`，我们将之抽象为二维表，管理满足此关系的数据(也叫元组)。

B+树，也叫平衡多路查找树。见名知意，平衡说明子树之间高度不会相差过大，多路说明每个结点里不止一个元素，查找树说明其内元素是按顺序存放的。

### Mysql与B+树有什么联系？

Mysql中的索引是使用B+树来组织和管理的。什么意思呢，索引就好比书籍的目录，通过它我们可以快速找到我们想要看的篇章，那么书籍的索引是由什么数据结构来组织和管理的呢，答案是线性表。

我们来对比一下在Mysql中查找某行数据(id已知)与在书籍里面查找某一章节的操作流程。

Mysql:

1. 从根节点出发，先在根结点内部使用二分搜索，找到这样两个相邻元素A、B(A < B.)，

   满足A <= id <= B，这两者之间存放着B+树下一层某个结点的指针，这个结点内的元素都大于A小于B

2. 接下来就在1中搜索得到的结点内搜索，流程与1一致，如此迭代，直到进入叶子结点。
3. 在叶子结点中，我们的目的是找到与id相等的元素，若是找到，则该元素后连接的数据就是我们要查找的数据(该元素后连接的也可能是该行数据的地址，这取决于存储引擎是如何实现的)；若找不到，则说明数据库中不存在该行数据。

书籍：

	1. 从目录第一行开始，一行一行的往下搜索，找到对应章节后，其后即为对应页数，我们直接翻到该页即可。

对比之下，显然可以发现Mysql中查找数据的流程比较复杂，但其中涉及查找的步骤都是通过二分搜索完成的，而书籍的目录查找是通过顺寻搜索完成的，前者时间复杂度是logn，后者是n。

### Mysql为什么选择B+树

仅就上面B+树展现的功能来看，似乎有很多其它数据结构可以代替，为什么Mysql偏偏选择B+树呢？回答这个问题的之前我们需要弄明白我们的诉求是什么，我们是希望尽可能快的查到我们想要的数据，并且往往我们需要查的是一个范围内的数据，不是一条数据；要提高查询速度我们就要减少查询时间，那查询时间由那些构成呢？是CPU运行时间和IO时间(任何程序的执行用时都是如此)。

明确了需求以后，再来对比几种可供选择的数据结构：

1. AVL、红黑树

   它们的查询时间都是O(logn)，也支持范围查询。但维护耗时，且每个结点内只存储一个元素，那么我们每次查询一个结点，就要进行一次磁盘IO，这显然是不可接受的。

2. Hash

   Hash的查询时间复杂度是O(1), 但其不支持范围查询，查询大量数据时，也同样面临着磁盘IO次数多的问题。

3. B树

   这是各方面表现最接近B+树的了，因为B+树本身也是B树的改良。相较于B+树，B树的一个问题就是非叶子结点内的元素也存储了数据本身(或其地址)，这就导致了相同数据量下，B树的层数会比B+树高(着意味着其平均IO时间会比B+树高)，或者说相同高度的B+树，能维护管理的数据更多。

***  请注意，上述本篇只是我个人的一些思考和总结，行文有点啰嗦，许多结论和推测依据也并不完善。如果你发现了任何错误，请在留言板或者通过邮件与我说明，不甚感激。**